# 🔐 Loomi-Lab 管理员密码管理指南

## 📋 概述

Loomi-Lab 管理平台采用基于配置文件的密码管理系统。管理员密码存储在 `.env` 文件中，修改密码后重启应用，所有现有登录会话将自动失效。

## 🛡️ 安全特性

### 密码失效机制
- ✅ **配置文件绑定**: JWT Token 与管理员密码绑定
- ✅ **自动失效**: 修改密码后，所有现有Token立即失效
- ✅ **强制重登**: 用户必须使用新密码重新登录
- ✅ **无缝切换**: 重启应用后新密码立即生效

### 登录界面安全
- ✅ **隐藏凭据**: 不显示真实用户名和密码
- ✅ **联系提示**: 引导用户联系管理员获取凭据
- ✅ **安全提醒**: 提供技术支持联系方式

## 🔧 密码管理工具

### 使用密码管理脚本

#### 1. 交互式修改密码
```bash
node scripts/change-admin-password.js
```

选项说明：
- **选项1**: 自动生成强密码（推荐）
- **选项2**: 自定义密码（需满足安全要求）

#### 2. 快速生成密码
```bash
node scripts/change-admin-password.js -g
```

#### 3. 查看帮助
```bash
node scripts/change-admin-password.js --help
```

### 手动修改密码

#### 1. 编辑配置文件
编辑 `.env` 文件：
```env
ADMIN_EMAIL=loomiadmin
ADMIN_PASSWORD=your-new-strong-password-here
```

#### 2. 重启应用
```bash
# 开发环境
npm run dev

# 生产环境
pm2 restart loomi-lab
```

## 📝 密码要求

### 强密码标准
- **长度**: 至少12位字符
- **复杂度**: 包含字母和数字
- **建议**: 包含特殊字符 (!@#$%^&*)
- **避免**: 常见密码、个人信息、重复字符

### 推荐密码类型
```bash
# 自动生成（最安全）
1e1505e386359b9f0b2a87be7f24fea8

# 强自定义密码示例
MySecureP@ssw0rd2025!
Admin#2025$Strong
```

## 🔄 密码修改流程

### 标准流程
1. **备份**: 自动备份当前 `.env` 文件
2. **生成**: 生成或输入新密码
3. **验证**: 检查密码强度
4. **更新**: 更新配置文件
5. **重启**: 重启应用使新密码生效
6. **验证**: 使用新密码登录测试

### 紧急修改流程
如需紧急修改密码：
1. 直接编辑 `.env` 文件
2. 修改 `ADMIN_PASSWORD=` 值
3. 重启应用
4. 通知相关人员新密码

## 🚨 故障排除

### 常见问题

#### 1. 登录失败
```
症状: 输入正确密码但无法登录
原因: 密码可能已被修改
解决: 检查 .env 文件中的当前密码
```

#### 2. Token失效
```
症状: 登录后很快被要求重新登录
原因: 密码在使用过程中被修改
解决: 使用当前有效密码重新登录
```

#### 3. 配置文件错误
```
症状: 应用启动失败
原因: .env 文件格式错误
解决: 检查配置文件语法，恢复备份文件
```

### 调试命令

#### 检查当前配置
```bash
# 查看当前管理员配置（密码会被隐藏）
node -e "console.log('用户名:', process.env.ADMIN_EMAIL); console.log('密码已设置:', !!process.env.ADMIN_PASSWORD)"
```

#### 验证Token状态
```bash
# API调用测试
curl -H "Authorization: Bearer YOUR_TOKEN" http://localhost:3000/api/auth/verify
```

## 📋 最佳实践

### 定期维护
- 🔄 **定期更换**: 建议每90天更换管理员密码
- 📝 **记录变更**: 记录密码修改时间和原因
- 👥 **通知团队**: 密码变更后及时通知相关人员
- 💾 **备份配置**: 定期备份配置文件

### 安全建议
- 🔐 **强密码**: 始终使用强密码
- 🚫 **不共享**: 不要通过不安全渠道分享密码
- 💻 **本地存储**: 使用密码管理器安全存储
- 🔍 **访问审计**: 定期检查登录日志

### 生产环境
- 🌐 **HTTPS**: 生产环境必须使用HTTPS
- 🔑 **密钥轮换**: 同时更换JWT密钥
- 🚧 **访问控制**: 限制 `.env` 文件访问权限
- 📊 **监控**: 监控异常登录活动

## 📞 技术支持

### 获取帮助
如遇到以下情况请联系技术支持：
- 忘记当前密码
- 配置文件损坏
- Token验证异常
- 登录功能故障

### 联系方式
- **工单系统**: 提交技术支持工单
- **内部联系**: 联系系统管理员
- **紧急情况**: 使用备用联系方式

---

**重要提醒**: 管理员密码是系统安全的关键，请务必妥善管理！