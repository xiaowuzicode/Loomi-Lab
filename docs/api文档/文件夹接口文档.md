# 文件夹结构 API 文档

本接口提供“可复用的文件夹树结构”服务，可作为多模块（如备忘录等）的基础能力。当前管理平台仅用于查看（只调用查询接口），但后端已具备基础的增删改动能，便于后续扩展。

## 数据模型

### FolderNode
```ts
interface FolderNode {
  fold_id: string       // UUID，节点唯一ID
  fold_name: string     // 名称（1-50）
  children: FolderNode[]// 子节点
  expanded?: boolean    // 前端状态字段（可选，不参与后端校验）
}
```

### 表结构（book_folds）
- 每个用户可对应多行，不同业务通过 `type` 字段区分；`fold_structure` 为完整树（JSONB）。
- 关键字段：`user_id`（外键指向 `users.id`）、`type`（业务标识，如“备忘录”、“帖子”）、`fold_structure`（JSONB）、`created_at`、`updated_at`。

## 基础说明
- Base URL：`/api/memo-folders`
- 鉴权：通过 `userId`（UUID）识别用户。
- 约束：
  - 名称长度 1–50；
  - 同级名称唯一；
  - 最大嵌套层级 10；
  - 禁止移动到自身或任一子孙节点下。

类型（type）说明：
- 通过 `type` 字段区分业务模块，例如 `memo`（备忘录）、`posts` 等。
- 所有接口均需显式传入 `type` 参数/字段。
- 若查询不到该类型的记录，返回空结构 `{ folders: [] }`；写操作按需自动初始化该类型记录。
- 目前约定：`type=memo` 会映射到数据库中的 `type="备忘录"`，`type=posts` 映射到 `type="帖子"`；其他值保持原样使用。

注意：
- GET：若 `userId` 不存在于 `users` 表，返回空结构 `{ folders: [] }`，不会写入记录。
- 其他写操作：`userId` 必须存在于 `users` 表，否则返回 `400 用户不存在`。

## 接口列表

### 1. 查询文件夹树（当前平台使用）
GET `/api/memo-folders?userId={userId}&type={type}`

参数：
| 名称 | 类型 | 必填 | 说明 |
|-----|------|------|------|
| userId | string | ✅ | 用户ID（UUID） |
| type | string | ✅ | 业务类型（如 memo） |

响应：
```json
{
  "success": true,
  "data": {
    "folders": [
      {
        "fold_id": "c6a9...",
        "fold_name": "一级目录1",
        "children": [
          { "fold_id": "8f3b...", "fold_name": "二级目录1", "children": [] }
        ]
      }
    ]
  }
}
```

错误：
- `userId` 非法：`400`；服务器异常：`500`。

### 2. 创建文件夹（预留）
POST `/api/memo-folders`

请求体：
```json
{ "userId": "uuid", "type": "memo", "fold_name": "新文件夹", "parent_id": null, "position": 0 }
```
返回：`{ success, data: { folders, created } }`

错误：用户不存在/父节点不存在/同级重名/超过最大层级。

### 3. 重命名文件夹（预留）
PUT `/api/memo-folders`

请求体：
```json
{ "userId": "uuid", "type": "memo", "action": "rename", "fold_id": "uuid", "fold_name": "新名称" }
```
返回：`{ success, data: { folders } }`

错误：用户不存在/记录不存在/同级重名。

### 4. 移动文件夹（预留）
PUT `/api/memo-folders`

请求体：
```json
{ "userId": "uuid", "type": "memo", "action": "move", "fold_id": "uuid", "new_parent_id": null, "position": 1 }
```
返回：`{ success, data: { folders } }`

错误：用户不存在/记录不存在/移动到自身或子孙/超过最大层级。

### 5. 删除文件夹（预留）
DELETE `/api/memo-folders`

请求体：
```json
{ "userId": "uuid", "type": "memo", "fold_id": "uuid" }
```
返回：`{ success, data: { folders, deletedIds } }`

错误：用户不存在/记录或目标不存在。

## 错误响应格式
```json
{ "success": false, "error": "错误信息" }
```

## 备注
- 本文档描述的“文件夹结构 API”可复用到多个业务场景；当前管理平台仅对 GET 进行集成展示，其余操作作为后续扩展能力预留。
