# è‡ªå®šä¹‰å­—æ®µç®¡ç†ç³»ç»Ÿ API æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

è‡ªå®šä¹‰å­—æ®µç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªçµæ´»çš„æ•°æ®è¡¨æ ¼ç®¡ç†å¹³å°ï¼Œæ”¯æŒåŠ¨æ€åˆ›å»ºå’Œç®¡ç†è¡¨æ ¼ã€å­—æ®µå’Œæ•°æ®è¡Œã€‚ç³»ç»Ÿé‡‡ç”¨ä¸‰å±‚æ¶æ„è®¾è®¡ï¼š
- **è¡¨æ ¼çº§åˆ«**ï¼šç®¡ç†æ•´ä¸ªæ•°æ®è¡¨æ ¼çš„åŸºæœ¬ä¿¡æ¯
- **å­—æ®µçº§åˆ«**ï¼šç®¡ç†è¡¨æ ¼çš„åˆ—ç»“æ„ï¼ˆå­—æ®µå®šä¹‰ï¼‰
- **è¡Œçº§åˆ«**ï¼šç®¡ç†è¡¨æ ¼çš„æ•°æ®è¡Œå†…å®¹

## æ•°æ®ç»“æ„

### è¡¨æ ¼è®°å½•ç»“æ„ (CustomFieldRecord)
```typescript
interface CustomFieldRecord {
  id: string              // è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)
  userId: string          // æ‰€å±ç”¨æˆ·ID (UUID)
  createdUserId: string   // åˆ›å»ºè€…ç”¨æˆ·ID (UUID)
  createdUserName: string // åˆ›å»ºè€…ç”¨æˆ·å
  appCode: string         // åº”ç”¨ä»£ç 
  type: string           // è¡¨æ ¼ç±»å‹ï¼š'æ´å¯Ÿ'|'é’©å­'|'æƒ…ç»ª'
  tableName: string      // è¡¨æ ¼åç§°
  extendedField: TableRow[] // è¡¨æ ¼æ•°æ®è¡Œ
  tableFields: string[]   // å­—æ®µååˆ—è¡¨
  amount: number         // é‡‘é¢ï¼ˆå…ƒï¼‰
  postIds: string[]      // å…³è”çš„å¸–å­ID
  visibility: boolean    // å¯è§æ€§
  isPublic: boolean      // æ˜¯å¦å…¬å¼€
  exampleData?: string   // ç¤ºä¾‹æ•°æ®
  readme: string         // æè¿°ä¿¡æ¯
  isDeleted: boolean     // æ˜¯å¦å·²åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
  createdAt: string      // åˆ›å»ºæ—¶é—´
  updatedAt: string      // æ›´æ–°æ—¶é—´
}
```

### è¡¨æ ¼è¡Œç»“æ„ (TableRow)
```typescript
interface TableRow {
  id: number             // è¡ŒID
  [fieldName: string]: any // åŠ¨æ€å­—æ®µå€¼
}
```

---

## API æ¥å£è¯¦æƒ…

### åŸºç¡€é…ç½®
- **Base URL**: `/api/custom-fields`
- **è®¤è¯æ–¹å¼**: ç”¨æˆ·IDå‚æ•°ä¼ é€’
- **æ•°æ®æ ¼å¼**: JSON

### ç”¨æˆ·èº«ä»½è¯†åˆ«

æ‰€æœ‰APIæ¥å£é€šè¿‡è¯·æ±‚å‚æ•°æˆ–è¯·æ±‚ä½“ä¸­çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œèº«ä»½è¯†åˆ«ï¼š

| å‚æ•° | ç±»å‹ | ä¼ é€’æ–¹å¼ | å¿…å¡« | è¯´æ˜ |
|------|------|----------|------|------|
| `userId` | string (UUID) | æŸ¥è¯¢å‚æ•°/è¯·æ±‚ä½“ | âœ… | ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦ |
| `id` | string (UUID) | æŸ¥è¯¢å‚æ•°/è¯·æ±‚ä½“ | è§†æƒ…å†µ | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ |
| `createdUserId` | string (UUID) | è¯·æ±‚ä½“ | åˆ›å»ºæ—¶å¿…å¡« | åˆ›å»ºè€…ç”¨æˆ·ID |

#### æƒé™æ§åˆ¶
- **æ•°æ®éš”ç¦»**: åŸºäºuserIdè¿›è¡Œæ•°æ®éš”ç¦»ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **è®¿é—®æƒé™**: åˆ›å»ºè€…å¯¹è¡¨æ ¼æ‹¥æœ‰å®Œå…¨æƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ ¹æ®å¯è§æ€§è®¾ç½®è®¿é—®
- **å‰ç«¯éªŒè¯**: å‰ç«¯è´Ÿè´£ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œåç«¯åŸºäºä¼ å…¥çš„userIdè¿›è¡Œæ•°æ®ç­›é€‰

---

## 1. è¡¨æ ¼ç®¡ç†æ¥å£

### 1.1 è·å–è¡¨æ ¼åˆ—è¡¨
**GET** `/api/custom-fields`

è·å–åˆ†é¡µçš„è¡¨æ ¼åˆ—è¡¨ï¼Œæ”¯æŒå¤šç§ç­›é€‰å’Œæœç´¢æ¡ä»¶ã€‚

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `userId` | string | âœ… | - | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæ•°æ®éš”ç¦» |
| `action` | string | å¦ | `list` | æ“ä½œç±»å‹ï¼Œå¯é€‰å€¼ï¼š`list`ã€`stats` |
| `page` | number | å¦ | 1 | é¡µç  |
| `limit` | number | å¦ | 10 | æ¯é¡µæ•°é‡ |
| `search` | string | å¦ | - | æœç´¢å…³é”®è¯ï¼ˆæœç´¢æ ‡é¢˜å’Œæè¿°ï¼‰ |
| `userSearch` | string | å¦ | - | ç”¨æˆ·æœç´¢ï¼ˆç”¨æˆ·åæˆ–UUIDï¼‰ |
| `type` | string | å¦ | `all` | è¡¨æ ¼ç±»å‹ç­›é€‰ï¼š`all`ã€`æ´å¯Ÿ`ã€`é’©å­`ã€`æƒ…ç»ª` |
| `appCode` | string | å¦ | - | åº”ç”¨ä»£ç ç­›é€‰ |
| `amountMin` | number | å¦ | - | æœ€å°é‡‘é¢ï¼ˆå…ƒï¼‰ |
| `amountMax` | number | å¦ | - | æœ€å¤§é‡‘é¢ï¼ˆå…ƒï¼‰ |
| `dateFrom` | string | å¦ | - | å¼€å§‹æ—¥æœŸï¼ˆISOæ ¼å¼ï¼‰ |
| `dateTo` | string | å¦ | - | ç»“æŸæ—¥æœŸï¼ˆISOæ ¼å¼ï¼‰ |
| `visibility` | boolean | å¦ | - | å¯è§æ€§ç­›é€‰ |
| `isPublic` | boolean | å¦ | - | å…¬å¼€æ€§ç­›é€‰ |
| `sortBy` | string | å¦ | `created_at` | æ’åºå­—æ®µ |
| `sortOrder` | string | å¦ | `desc` | æ’åºæ–¹å‘ï¼š`asc`ã€`desc` |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid-1234",
      "tableName": "ç”¨æˆ·åé¦ˆè¡¨",
      "type": "æ´å¯Ÿ",
      "tableFields": ["æ ‡é¢˜", "æ­£æ–‡", "åˆ†ç±»"],
      "extendedField": [
        {"id": 1, "æ ‡é¢˜": "åŠŸèƒ½å»ºè®®", "æ­£æ–‡": "å¸Œæœ›å¢åŠ å¯¼å‡ºåŠŸèƒ½", "åˆ†ç±»": "åŠŸèƒ½"}
      ],
      "createdUserName": "ç®¡ç†å‘˜",
      "createdAt": "2023-12-01T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "totalPages": 3
  }
}
```

### 1.2 è·å–ç»Ÿè®¡ä¿¡æ¯
**GET** `/api/custom-fields?action=stats&userId={userId}`

è·å–æŒ‡å®šç”¨æˆ·çš„å„ç±»å‹è¡¨æ ¼ç»Ÿè®¡æ•°é‡ã€‚

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæ•°æ®éš”ç¦» |
| `action` | string | âœ… | å›ºå®šå€¼ï¼š`stats` |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "æ´å¯Ÿ": 15,
    "é’©å­": 8,
    "æƒ…ç»ª": 12,
    "æ€»è®¡": 35
  }
}
```

### 1.3 è·å–å•ä¸ªè¡¨æ ¼è¯¦æƒ…
**GET** `/api/custom-fields?id={tableId}&userId={userId}`

æ ¹æ®è¡¨æ ¼IDè·å–è¯¦ç»†ä¿¡æ¯ã€‚

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": "uuid-1234",
    "tableName": "ç”¨æˆ·åé¦ˆè¡¨",
    "type": "æ´å¯Ÿ",
    "appCode": "loomi",
    "tableFields": ["æ ‡é¢˜", "æ­£æ–‡", "åˆ†ç±»", "çŠ¶æ€"],
    "extendedField": [
      {"id": 1, "æ ‡é¢˜": "åŠŸèƒ½å»ºè®®", "æ­£æ–‡": "å¸Œæœ›å¢åŠ å¯¼å‡ºåŠŸèƒ½", "åˆ†ç±»": "åŠŸèƒ½", "çŠ¶æ€": "å¾…å¤„ç†"},
      {"id": 2, "æ ‡é¢˜": "ç•Œé¢ä¼˜åŒ–", "æ­£æ–‡": "æŒ‰é’®å¤ªå°", "åˆ†ç±»": "UI", "çŠ¶æ€": "å·²å®Œæˆ"}
    ],
    "amount": 0,
    "readme": "æ”¶é›†ç”¨æˆ·åé¦ˆä¿¡æ¯",
    "visibility": true,
    "isPublic": false,
    "createdAt": "2023-12-01T10:00:00Z"
  }
}
```

### 1.4 åˆ›å»ºæ–°è¡¨æ ¼
**POST** `/api/custom-fields`

åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®è¡¨æ ¼ã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "createdUserId": "123e4567-e89b-12d3-a456-426614174000",
  "appCode": "loomi",
  "type": "æ´å¯Ÿ",
  "tableName": "æ–°å»ºè¡¨æ ¼",
  "extendedField": [
    {"key": "title", "label": "æ ‡é¢˜", "value": "", "required": true}
  ],
  "amount": 0,
  "readme": "è¡¨æ ¼æè¿°ä¿¡æ¯",
  "exampleData": "ç¤ºä¾‹æ•°æ®è¯´æ˜",
  "visibility": true,
  "isPublic": false
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œè¡¨æ ¼æ‰€å±ç”¨æˆ· |
| `createdUserId` | string | âœ… | åˆ›å»ºè€…ç”¨æˆ·ID (UUID) |
| `appCode` | string | æ˜¯ | åº”ç”¨ä»£ç  |
| `type` | string | æ˜¯ | è¡¨æ ¼ç±»å‹ï¼š`æ´å¯Ÿ`ã€`é’©å­`ã€`æƒ…ç»ª` |
| `tableName` | string | æ˜¯ | è¡¨æ ¼åç§°ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰ |
| `extendedField` | array | æ˜¯ | åˆå§‹å­—æ®µå®šä¹‰ |
| `amount` | number | å¦ | é‡‘é¢ï¼ˆå…ƒï¼‰ï¼Œé»˜è®¤0 |
| `readme` | string | æ˜¯ | è¡¨æ ¼æè¿° |
| `exampleData` | string | å¦ | ç¤ºä¾‹æ•°æ® |
| `visibility` | boolean | å¦ | å¯è§æ€§ï¼Œé»˜è®¤true |
| `isPublic` | boolean | å¦ | æ˜¯å¦å…¬å¼€ï¼Œé»˜è®¤false |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": "uuid-5678",
    "tableName": "æ–°å»ºè¡¨æ ¼",
    "type": "æ´å¯Ÿ",
    "tableFields": ["æ ‡é¢˜"],
    "extendedField": [{"id": 1, "æ ‡é¢˜": ""}]
  },
  "message": "åˆ›å»ºæˆåŠŸ"
}
```

### 1.5 æ›´æ–°è¡¨æ ¼
**PUT** `/api/custom-fields`

æ›´æ–°ç°æœ‰è¡¨æ ¼çš„åŸºæœ¬ä¿¡æ¯ã€‚

#### è¯·æ±‚ä½“ï¼ˆuserIdå’Œidä¸ºå¿…å¡«ï¼Œå…¶ä»–å­—æ®µå¯é€‰ï¼‰
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "appCode": "loomi",
  "extendedField": [...],
  "amount": 100,
  "readme": "æ›´æ–°åçš„æè¿°",
  "exampleData": "æ›´æ–°çš„ç¤ºä¾‹",
  "visibility": false,
  "isPublic": true
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| å…¶ä»–å­—æ®µ | - | å¦ | è¦æ›´æ–°çš„å­—æ®µï¼Œå‚è€ƒåˆ›å»ºæ¥å£ |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": { /* æ›´æ–°åçš„è¡¨æ ¼ä¿¡æ¯ */ },
  "message": "æ›´æ–°æˆåŠŸ"
}
```

### 1.6 åˆ é™¤è¡¨æ ¼
**DELETE** `/api/custom-fields`

è½¯åˆ é™¤è¡¨æ ¼ï¼ˆæ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œä¸ä¼šç‰©ç†åˆ é™¤ï¼‰ã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456"
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": { /* åˆ é™¤åçš„è¡¨æ ¼ä¿¡æ¯ */ },
  "message": "åˆ é™¤æˆåŠŸ"
}
```

---

## 2. å­—æ®µç®¡ç†æ¥å£

### 2.1 å­—æ®µæ“ä½œ
**PUT** `/api/custom-fields/fields`

å¯¹è¡¨æ ¼å­—æ®µè¿›è¡Œæ·»åŠ ã€åˆ é™¤æˆ–é‡å‘½åæ“ä½œã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "action": "add",
  "fieldName": "æ–°å­—æ®µå",
  "newFieldName": "é‡å‘½ååçš„å­—æ®µå"
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `action` | string | âœ… | æ“ä½œç±»å‹ï¼š`add`ï¼ˆæ·»åŠ ï¼‰ã€`remove`ï¼ˆåˆ é™¤ï¼‰ã€`rename`ï¼ˆé‡å‘½åï¼‰ |
| `fieldName` | string | âœ… | ç›®æ ‡å­—æ®µå |
| `newFieldName` | string | æ¡ä»¶ | é‡å‘½åæ“ä½œæ—¶çš„æ–°å­—æ®µåï¼ˆä»…renameæ“ä½œéœ€è¦ï¼‰ |

#### æ“ä½œè¯´æ˜
- **æ·»åŠ å­—æ®µ**: åœ¨è¡¨æ ¼æœ«å°¾æ·»åŠ æ–°å­—æ®µï¼Œæ‰€æœ‰ç°æœ‰è¡Œçš„è¯¥å­—æ®µå€¼åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²
- **åˆ é™¤å­—æ®µ**: ä»æ‰€æœ‰è¡Œä¸­ç§»é™¤æŒ‡å®šå­—æ®µï¼ˆæ ‡é¢˜å­—æ®µå—ä¿æŠ¤ï¼Œä¸å¯åˆ é™¤ï¼‰
- **é‡å‘½åå­—æ®µ**: ä¿®æ”¹å­—æ®µåï¼ˆæ ‡é¢˜å­—æ®µå—ä¿æŠ¤ï¼Œä¸å¯é‡å‘½åï¼‰

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": "uuid-1234",
    "tableFields": ["æ ‡é¢˜", "æ­£æ–‡", "æ–°å­—æ®µå"],
    "extendedField": [
      {"id": 1, "æ ‡é¢˜": "æµ‹è¯•", "æ­£æ–‡": "å†…å®¹", "æ–°å­—æ®µå": ""},
      {"id": 2, "æ ‡é¢˜": "ç¤ºä¾‹", "æ­£æ–‡": "æ–‡æœ¬", "æ–°å­—æ®µå": ""}
    ]
  },
  "message": "å­—æ®µæ·»åŠ æˆåŠŸ"
}
```

---

## 3. è¡Œæ•°æ®ç®¡ç†æ¥å£

### 3.1 æ·»åŠ æ•°æ®è¡Œ
**POST** `/api/custom-fields/rows`

å‘æŒ‡å®šè¡¨æ ¼æ·»åŠ æ–°çš„æ•°æ®è¡Œã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "rowData": {
    "æ ‡é¢˜": "æ–°è¡Œæ ‡é¢˜",
    "æ­£æ–‡": "æ–°è¡Œå†…å®¹",
    "åˆ†ç±»": "ç¤ºä¾‹"
  }
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `rowData` | object | å¦ | è¡Œæ•°æ®ï¼Œé”®ä¸ºå­—æ®µåï¼Œå€¼ä¸ºå­—æ®µå€¼ |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": {
    "id": "uuid-1234",
    "extendedField": [
      {"id": 1, "æ ‡é¢˜": "ç°æœ‰è¡Œ", "æ­£æ–‡": "ç°æœ‰å†…å®¹"},
      {"id": 2, "æ ‡é¢˜": "æ–°è¡Œæ ‡é¢˜", "æ­£æ–‡": "æ–°è¡Œå†…å®¹", "åˆ†ç±»": "ç¤ºä¾‹"}
    ]
  },
  "message": "æ·»åŠ è¡ŒæˆåŠŸ"
}
```

### 3.2 æ›´æ–°æ•°æ®è¡Œ
**PUT** `/api/custom-fields/rows`

æ›´æ–°æŒ‡å®šè¡Œçš„æ•°æ®ã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "rowId": 1,
  "action": "update",
  "rowData": {
    "æ ‡é¢˜": "æ›´æ–°åçš„æ ‡é¢˜",
    "æ­£æ–‡": "æ›´æ–°åçš„å†…å®¹"
  }
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `rowId` | number | âœ… | è¡ŒID |
| `action` | string | å¦ | æ“ä½œç±»å‹ï¼š`update`ï¼ˆæ›´æ–°ï¼‰ã€`duplicate`ï¼ˆå¤åˆ¶ï¼‰ï¼Œé»˜è®¤`update` |
| `rowData` | object | å¦ | è¦æ›´æ–°çš„å­—æ®µæ•°æ® |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": { /* æ›´æ–°åçš„è¡¨æ ¼æ•°æ® */ },
  "message": "æ›´æ–°æˆåŠŸ"
}
```

### 3.3 å¤åˆ¶æ•°æ®è¡Œ
**PUT** `/api/custom-fields/rows`

å¤åˆ¶æŒ‡å®šè¡Œï¼Œåˆ›å»ºä¸€ä¸ªæ–°è¡Œã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "rowId": 1,
  "action": "duplicate"
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `rowId` | number | âœ… | è¦å¤åˆ¶çš„è¡ŒID |
| `action` | string | âœ… | å›ºå®šå€¼ï¼š`duplicate` |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": { /* åŒ…å«æ–°å¤åˆ¶è¡Œçš„è¡¨æ ¼æ•°æ® */ },
  "message": "å¤åˆ¶æˆåŠŸ"
}
```

### 3.4 åˆ é™¤æ•°æ®è¡Œ
**DELETE** `/api/custom-fields/rows`

åˆ é™¤æŒ‡å®šçš„æ•°æ®è¡Œã€‚

#### è¯·æ±‚ä½“
```json
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "id": "456e7890-e12b-34c5-d678-567890123456",
  "rowId": 1
}
```

#### å­—æ®µè¯´æ˜
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `userId` | string | âœ… | ç”¨æˆ·ID (UUID)ï¼Œç”¨äºæƒé™éªŒè¯ |
| `id` | string | âœ… | è¡¨æ ¼å”¯ä¸€æ ‡è¯†ç¬¦ (UUID) |
| `rowId` | number | âœ… | è¦åˆ é™¤çš„è¡ŒID |

#### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "data": { /* åˆ é™¤è¡Œåçš„è¡¨æ ¼æ•°æ® */ },
  "message": "åˆ é™¤è¡ŒæˆåŠŸ"
}
```

---

## é”™è¯¯å¤„ç†

### æ ‡å‡†é”™è¯¯å“åº”æ ¼å¼
```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### å¸¸è§é”™è¯¯ä»£ç 
| HTTPçŠ¶æ€ç  | è¯´æ˜ | ç¤ºä¾‹åœºæ™¯ |
|------------|------|----------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | ç¼ºå°‘å¿…å¡«å­—æ®µã€å‚æ•°æ ¼å¼é”™è¯¯ |
| 401 | æœªæˆæƒè®¿é—® | ç¼ºå°‘è®¤è¯Tokenæˆ–Tokenæ— æ•ˆ |
| 404 | èµ„æºä¸å­˜åœ¨ | è¡¨æ ¼IDä¸å­˜åœ¨ã€è¡ŒIDä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“è¿æ¥é”™è¯¯ã€ç³»ç»Ÿå¼‚å¸¸ |

### é”™è¯¯ç¤ºä¾‹
```json
{
  "success": false,
  "error": "ç¼ºå°‘å¿…å¡«å­—æ®µ"
}
```

---

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å·¥ä½œæµç¨‹

#### 1. åˆ›å»ºè¡¨æ ¼
```javascript
const userId = "123e4567-e89b-12d3-a456-426614174000";
const createdUserId = "123e4567-e89b-12d3-a456-426614174000";

const response = await fetch('/api/custom-fields', {
  method: 'POST',
  body: JSON.stringify({
    userId: userId,
    createdUserId: createdUserId,
    appCode: 'loomi',
    type: 'æ´å¯Ÿ',
    tableName: 'å®¢æˆ·åé¦ˆæ”¶é›†è¡¨',
    extendedField: [
      {key: 'title', label: 'æ ‡é¢˜', value: '', required: true}
    ],
    readme: 'ç”¨äºæ”¶é›†å®¢æˆ·åé¦ˆæ„è§',
    visibility: true,
    isPublic: false
  })
});

const createResult = await response.json();
const tableId = createResult.data.id; // è·å–åˆ›å»ºçš„è¡¨æ ¼ID
```

#### 2. æ·»åŠ å­—æ®µ
```javascript
const addFieldResponse = await fetch('/api/custom-fields/fields', {
  method: 'PUT',
  body: JSON.stringify({
    userId: userId,
    id: tableId,
    action: 'add',
    fieldName: 'ä¼˜å…ˆçº§'
  })
});
```

#### 3. æ·»åŠ æ•°æ®è¡Œ
```javascript
const addRowResponse = await fetch('/api/custom-fields/rows', {
  method: 'POST',
  body: JSON.stringify({
    userId: userId,
    id: tableId,
    rowData: {
      'æ ‡é¢˜': 'ç•Œé¢ä¼˜åŒ–å»ºè®®',
      'ä¼˜å…ˆçº§': 'é«˜'
    }
  })
});
```


---

## æ³¨æ„äº‹é¡¹

### ğŸ” ç”¨æˆ·èº«ä»½å’Œæƒé™
1. **ç”¨æˆ·æ ‡è¯†**: æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å‚æ•°æˆ–è¯·æ±‚ä½“ä¸­ä¼ é€’æœ‰æ•ˆçš„userId
2. **UUIDæ ¼å¼**: userIdå’Œidå¿…é¡»ä½¿ç”¨æ ‡å‡†UUIDæ ¼å¼
3. **æ•°æ®éš”ç¦»**: åŸºäºuserIdè¿›è¡Œæ•°æ®éš”ç¦»ï¼Œç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
4. **æƒé™æ§åˆ¶**: åˆ›å»ºè€…å¯¹è¡¨æ ¼æ‹¥æœ‰å®Œå…¨æƒé™ï¼Œå…¶ä»–ç”¨æˆ·æ ¹æ®å¯è§æ€§è®¾ç½®è®¿é—®
5. **å‰ç«¯éªŒè¯**: å‰ç«¯è´Ÿè´£ç”¨æˆ·èº«ä»½éªŒè¯ï¼Œç¡®ä¿ä¼ é€’æ­£ç¡®çš„ç”¨æˆ·ID

### ğŸ’¾ æ•°æ®å¤„ç†
6. **è½¯åˆ é™¤**: è¡¨æ ¼åˆ é™¤é‡‡ç”¨è½¯åˆ é™¤æœºåˆ¶ï¼Œæ•°æ®ä¸ä¼šè¢«ç‰©ç†åˆ é™¤
7. **å­—æ®µä¿æŠ¤**: "æ ‡é¢˜"å­—æ®µå—åˆ°ç‰¹æ®Šä¿æŠ¤ï¼Œä¸èƒ½è¢«åˆ é™¤æˆ–é‡å‘½å
8. **æ•°æ®æ ¼å¼**: æ‰©å±•å­—æ®µæ”¯æŒæ–°æ—§ä¸¤ç§æ ¼å¼çš„è‡ªåŠ¨è½¬æ¢
9. **é‡‘é¢å•ä½**: å‰ç«¯ä¼ é€’çš„é‡‘é¢å•ä½ä¸ºå…ƒï¼Œåç«¯å­˜å‚¨æ—¶è‡ªåŠ¨è½¬æ¢ä¸ºåˆ†

### ğŸš€ æ€§èƒ½ä¼˜åŒ–  
10. **åˆ†é¡µé™åˆ¶**: åˆ—è¡¨æŸ¥è¯¢æ”¯æŒåˆ†é¡µï¼Œå»ºè®®åˆç†è®¾ç½®åˆ†é¡µå¤§å°ä»¥æé«˜æ€§èƒ½

### ğŸ¯ å½“å‰ç³»ç»Ÿç‰¹ç‚¹
11. **ç”¨æˆ·é©±åŠ¨**: åŸºäºç”¨æˆ·IDè¿›è¡Œæ•°æ®éš”ç¦»å’Œæƒé™æ§åˆ¶
12. **å‰ç«¯é›†æˆ**: è®¾è®¡ä¸ºå‰ç«¯å‹å¥½çš„APIï¼Œæ”¯æŒç›´æ¥ä¼ é€’ç”¨æˆ·å‚æ•°
13. **æ•°æ®å®‰å…¨**: é€šè¿‡è¯·æ±‚å‚æ•°éªŒè¯ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®

### ğŸ› ï¸ å¼€å‘å»ºè®®
14. **é”™è¯¯å¤„ç†**: è¯·æ±‚å¤±è´¥æ—¶æ£€æŸ¥HTTPçŠ¶æ€ç å’Œå“åº”ä¸­çš„errorå­—æ®µ
15. **å‚æ•°éªŒè¯**: ç¡®ä¿æ‰€æœ‰UUIDæ ¼å¼çš„å‚æ•°ç¬¦åˆæ ‡å‡†æ ¼å¼
16. **æ•°æ®æ ¡éªŒ**: å‰ç«¯åº”å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒåŸºç¡€æ ¡éªŒï¼Œåç«¯ä¼šè¿›è¡Œå®Œæ•´çš„æ•°æ®éªŒè¯

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

### æ ‡å‡†è¯·æ±‚å‚æ•°æ¨¡æ¿
```javascript
// ç”¨æˆ·èº«ä»½å‚æ•°ï¼ˆæ ¹æ®æ¥å£ç±»å‹é€‰æ‹©ä¼ é€’æ–¹å¼ï¼‰
const userParams = {
  userId: "123e4567-e89b-12d3-a456-426614174000",  // å¿…é¡»ï¼šç”¨æˆ·ID
  id: "456e7890-e12b-34c5-d678-567890123456",      // è§†æƒ…å†µï¼šè¡¨æ ¼ID
  createdUserId: "123e4567-e89b-12d3-a456-426614174000"  // åˆ›å»ºæ—¶ï¼šåˆ›å»ºè€…ID
}

// GETè¯·æ±‚ - é€šè¿‡æŸ¥è¯¢å‚æ•°ä¼ é€’
const queryParams = new URLSearchParams(userParams).toString();
const response = await fetch(`/api/custom-fields?${queryParams}`);

// POST/PUT/DELETEè¯·æ±‚ - é€šè¿‡è¯·æ±‚ä½“ä¼ é€’
const response = await fetch('/api/custom-fields', {
  method: 'POST',
  body: JSON.stringify({
    ...userParams,
    // å…¶ä»–ä¸šåŠ¡å‚æ•°
  })
});
```

### UUIDç”Ÿæˆç¤ºä¾‹
```javascript
// ç”Ÿæˆæ ‡å‡†UUID
function generateUUID() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c == 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

const userId = generateUUID(); // "123e4567-e89b-12d3-a456-426614174000"
```
