# 📁 文件上传功能使用指南

## 🚀 功能状态

**✅ 已完成**: 文件上传功能现在已经完全实现并可以正常使用！

## 🎯 使用步骤

### 1. 访问知识库管理页面
```
http://localhost:3000/knowledge-base-v2
```

### 2. 选择知识库
- 在左侧边栏选择 `xiaohongshu_posts` 知识库
- 或创建一个新的知识库

### 3. 进入数据管理标签页
- 点击顶部的"数据管理"标签页
- 看到文件上传区域

### 4. 上传文件
- 点击"选择文件"按钮
- 选择 `test_minsu_data.json` 文件
- 系统会自动：
  - 验证文件格式（JSON/CSV）
  - 检查文件大小（<10MB）
  - 读取文件内容
  - 调用向量化API
  - 存储到Milvus数据库
  - 显示上传结果

## 📊 测试数据说明

### 🏠 民宿数据文件: `test_minsu_data.json`
- **记录数量**: 8条精心设计的民宿内容
- **涵盖城市**: 厦门、大理、成都、杭州、桂林、丽江、青岛、苏州
- **内容特色**: 真实的小红书风格内容
- **字段完整**: title、content、likes、author、tags等

### 🔍 测试数据预览
```json
{
  "title": "厦门鼓浪屿海景民宿 | 推窗见海的绝美体验",
  "content": "这次在鼓浪屿住的海景民宿真的太赞了！位置就在海边，推开窗户就能看到蔚蓝的大海。房间装修很有文艺气息，白色简约风格配上木质家具，超级舒服。早上醒来就能听到海浪声，晚上还能在阳台上看夕阳西下。民宿主人特别贴心，提供了详细的岛上游玩攻略，还推荐了很多当地美食。强烈推荐给想要度假放松的朋友！",
  "cover_image_url": "https://example.com/images/xiamen-seaview-minsu.jpg",
  "video_url": "https://example.com/videos/xiamen-minsu-tour.mp4",
  "likes": 2856,
  "favorites": 1347,
  "comments": 289,
  "author": "旅行达人小雨",
  "tags": "厦门,鼓浪屿,海景民宿,度假,文艺",
  "publish_time": "2024-03-20 15:30:00"
}
```

## 🧪 RAG搜索测试

### 推荐测试关键词
上传民宿数据后，可以在"RAG召回测试"标签页进行搜索测试：

- **"民宿"** - 应该找到所有8条记录
- **"海景"** - 厦门鼓浪屿内容
- **"文艺"** - 厦门和杭州内容  
- **"古城"** - 大理和丽江内容
- **"四合院"** - 成都内容
- **"白族"** - 大理内容
- **"纳西族"** - 丽江内容
- **"德式建筑"** - 青岛内容
- **"园林"** - 苏州内容

### 相似度阈值建议
- **建议设置**: 0.01 - 0.05
- **获得最佳搜索结果**: 较低的阈值能找到更多相关内容

## 🔧 技术实现

### 前端功能
- **文件验证**: 自动检查文件格式和大小
- **异步上传**: 不阻塞用户界面
- **进度反馈**: Toast提示上传状态
- **错误处理**: 友好的错误信息展示
- **状态更新**: 自动刷新知识库数据

### 后端处理
- **格式支持**: JSON和CSV两种数据格式
- **数据验证**: 验证数据结构和完整性
- **向量化**: 使用OpenAI embedding模型
- **批量插入**: 高效的数据库插入操作
- **导入历史**: 记录所有导入操作

## 📈 验证结果

### 当前数据状态
```
知识库: lab_xiaohongshu_posts
记录数量: 14条 (原有6条 + 新增8条民宿数据)
状态: ✅ 活跃
```

### API测试结果
```bash
✅ 文件读取成功
✅ JSON解析成功 (8条记录)
✅ API导入成功
✅ 数据库插入成功
✅ 向量化完成
```

## 🎉 功能特色

### 1. 智能文件处理
- 自动识别JSON/CSV格式
- 智能解析不同的JSON结构
- 支持嵌套数据和数组格式

### 2. 完整的用户反馈
- 上传进度提示
- 成功/失败状态反馈
- 详细的错误信息
- 导入统计数据

### 3. 数据完整性保证
- 文件大小限制（10MB）
- 格式验证和错误处理
- 导入历史记录
- 事务性操作保证

### 4. 无缝集成
- 与现有知识库系统完美集成
- 自动更新UI状态
- 支持多知识库管理
- 实时数据同步

## 🚀 下一步操作

1. **上传测试数据**: 使用 `test_minsu_data.json` 文件测试上传功能
2. **测试RAG搜索**: 使用推荐关键词进行相似度搜索
3. **验证向量化**: 确认数据成功转换为向量并存储
4. **探索删除功能**: 在"设置"标签页测试数据管理功能

## 📚 相关文档

- **`MILVUS_DATA_MANAGEMENT.md`** - 数据删除和管理指南
- **`MILVUS_INTEGRATION.md`** - Milvus集成技术文档
- **`TEMPLATE_GUIDE.md`** - 数据模版使用说明

---

**🎊 恭喜！文件上传功能现在已经完全可用，你可以开始上传和测试民宿数据了！**
